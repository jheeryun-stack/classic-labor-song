<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>당신을 위한 클래식 노동요</title>
  <style>
    body {
      margin: 0;
      background: white;
      overflow: hidden;
      height: 100vh;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    /* 인트로 화면 */
    #intro {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: black;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 2000;
    }

    #intro img {
      width: 200px;
      height: auto;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    #headline {
      font-size: 28px;
      margin-bottom: 15px;
    }

    #subtitle {
      font-size: 16px;
      max-width: 500px;
      line-height: 1.5;
    }

    #intro-play {
      margin-left: 10px;
      font-size: 18px;
      background: transparent;
      border: none;
      color: white;
      cursor: pointer;
    }

    /* 플레이어 */
    #player {
      position: relative;
      z-index: 1000;
      text-align: center;
      margin-bottom: 80px;
      transform: scale(0.8); /* 전체 UI 축소 */
    }

    #title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 6px;
    }

    #composer {
      font-size: 13px;
      color: #555;
      margin-bottom: 12px;
    }

    #progress-container {
      width: 300px;
      height: 6px;
      background: #ddd;
      border-radius: 3px;
      margin: 0 auto 12px auto;
      cursor: pointer;
      position: relative;
    }

    #progress {
      width: 0;
      height: 100%;
      background: black;
      border-radius: 3px;
    }

    #controls {
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    #controls button {
      font-size: 22px;
      padding: 0;
      border: none;
      background: transparent;
      color: black;
      cursor: pointer;
    }

    #floor {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100px;
      background: black;
      z-index: 500;
    }

    .note {
      position: absolute;
      width: 30px;
      height: 30px;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <!-- 인트로 화면 -->
  <div id="intro">
    <img id="bach" src="bach1.webp" alt="Bach">
    <h1 id="headline">당신을 위한 클래식 노동요</h1>
    <p id="subtitle">
      혹시 과제 제출이 30분 남았나요?<br>
      이 플레이리스트는 30분 안에 모든 일을 끝내게 해드립니다.
      <button id="intro-play">▶</button>
    </p>
  </div>

  <!-- 메인 플레이어 -->
  <div id="player" style="display:none;">
    <div id="title">곡 제목</div>
    <div id="composer">작곡가</div>

    <div id="progress-container">
      <div id="progress"></div>
    </div>

    <div id="controls">
      <button id="play">▶</button>
      <button id="pause">⏸</button>
      <button id="next">⏭</button>
    </div>
  </div>

  <div id="floor"></div>

  <script>
    // ====== 인트로 관련 ======
    const intro = document.getElementById("intro");
    const playerUI = document.getElementById("player");
    const bach = document.getElementById("bach");
    const introBtn = document.getElementById("intro-play");

    const introMusic = new Audio("intro.mp3");
    introMusic.loop = true; // 반복 재생 (버튼 누르기 전까지 계속)
    introMusic.play();

    let bachImages = ["bach1.webp", "bach2.webp"];
    let imgIndex = 0;

    // 3초마다 이미지 변경
    setInterval(() => {
      imgIndex = (imgIndex + 1) % bachImages.length;
      bach.src = bachImages[imgIndex];
    }, 3000);

    // ====== 플레이리스트 ======
    const playlist = [
      { title: "Requiem in D Minor, K. 626: Lacrimosa", composer: "Wolfgang Amadeus Mozart", src: "music1.mp3" },
      { title: "The Day Before", composer: "Maya Belsitzman", src: "music2.mp3" },
      { title: "Rain", composer: "Ryuichi Sakamoto", src: "music3.mp3" },
      { title: "Symphony No. 25 In G Minor, K. 183", composer: "Wolfgang Amadeus Mozart", src: "music4.mp3" },
      { title: "The Last Time", composer: "Ryo Yoshimata", src: "music5.mp3" },
      { title: "Symphony No. 5 in C Minor, Op. 67 - I. Allegro con brio", composer: "Ludwig van Beethoven", src: "music6.mp3" }
    ];

    let currentTrack = 0;
    const audio = new Audio();

    const titleEl = document.getElementById("title");
    const composerEl = document.getElementById("composer");
    const progressContainer = document.getElementById("progress-container");
    const progress = document.getElementById("progress");

    function loadTrack(index) {
      currentTrack = index;
      audio.src = playlist[currentTrack].src;
      titleEl.textContent = playlist[currentTrack].title;
      composerEl.textContent = playlist[currentTrack].composer;
      audio.load();
    }

    function playTrack() {
      audio.play();
      startNotes();
    }

    function pauseTrack() {
      audio.pause();
    }

    function nextTrack() {
      currentTrack = (currentTrack + 1) % playlist.length;
      loadTrack(currentTrack);
      playTrack();
    }

    audio.addEventListener("timeupdate", () => {
      const percent = (audio.currentTime / audio.duration) * 100;
      progress.style.width = percent + "%";
    });

    progressContainer.addEventListener("click", (e) => {
      const width = progressContainer.clientWidth;
      const clickX = e.offsetX;
      const duration = audio.duration;
      audio.currentTime = (clickX / width) * duration;
    });

    document.getElementById("play").onclick = playTrack;
    document.getElementById("pause").onclick = pauseTrack;
    document.getElementById("next").onclick = nextTrack;

    loadTrack(currentTrack);

    // ====== 버튼 클릭 시: intro 멈추고 메인 시작 ======
    introBtn.onclick = () => {
      introMusic.pause();
      introMusic.currentTime = 0;
      intro.style.display = "none";
      playerUI.style.display = "block";
      playTrack(); // 바로 첫 곡 재생
    };

    // ====== 음표 비 ======
    const noteImages = ["note1.png", "note2.png", "note3.png", "note4.png"];
    let intervalId = null;

    function createNote() {
      const note = document.createElement("img");
      note.src = noteImages[Math.floor(Math.random() * noteImages.length)];
      note.className = "note";
      note.style.left = Math.random() * (window.innerWidth - 40) + "px";
      note.style.top = "-40px";
      document.body.appendChild(note);

      let y = -40;
      let vy = 2 + Math.random() * 3;

      let changeInterval = setInterval(() => {
        note.src = noteImages[Math.floor(Math.random() * noteImages.length)];
      }, 200);

      function fall() {
        y += vy;
        note.style.top = y + "px";

        if (y >= window.innerHeight - 140) {
          clearInterval(changeInterval);
          note.remove();
        } else {
          requestAnimationFrame(fall);
        }
      }
      fall();
    }

    function startNotes() {
      if (!intervalId) {
        intervalId = setInterval(createNote, 500);
      }
    }
  </script>
</body>
</html>
